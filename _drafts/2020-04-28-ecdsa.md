---
layout: post
title: 'ECDSA - hệ mật dựa trên đường cong Elliptic và ứng dụng trong blockchain'
mathjax: true
---

## Intro

ECDSA là viết tắt của Elliptic Curve Digital Signature Algorithm - thuật toán sinh _chữ ký số_ dựa trên đường cong Elliptic.

ECDSA được sử dụng để tạo chữ kí số cho dữ liệu, giúp chống lại sự giả mạo cũng như làm sai lệch dữ liệu, cung cấp một phương pháp xác thực mà không ảnh hưởng đến tính bảo mật của dữ liệu gốc.

ECDSA được ứng dụng rộng rãi trong rất nhiều lĩnh vực cần tính bảo mật và sự riêng tư dữ liệu, đặc biệt như trong **Blockchain**.

Trong bài viết này mình sẽ trình bày tổng quan về ECDSA nói chung và ứng dụng của nó trong **Blockchain** nói riêng.

## Tại sao lại sử dụng ECDSA

ECDSA là thuật toán mã hoá **bất đối xứng**.

Nó khác với các mã hoá **đối xứng** khác như AES, ta có một key duy nhất để mã hoá dữ liệu và giải mã. Nó đồng nghĩa với việc biết key là biết tất cả, và không biết key thì không biết gì.

ECDSA thì khác, nó có một cặp key `private key` và `public key`. `private key` dùng dể mã hoá, `public key` dùng để xác nhận (verify) tính đúng đắn của dữ liệu đã được mã hoá này, và chỉ vậy mà thôi. `public key` không thể giải mã được dữ liệu đã được mã hoá, do đó dữ liệu gốc luôn luôn được an toàn.

Tại sao lại sử dụng mã hoá bất đối xứng ? Vì mục đích của nó không phải là để **mã hoá** các dữ liệu. Thay vào đó, sự hữu ích của nó thể hiện ở việc nó có thể tạo ra được **chữ ký số**. Với mỗi văn bản, hay giao dịch, hay dữ liệu bất kì, ta có thể tạo ra được một dữ liệu **kèm chữ ký**. Chữ ký này chỉ có thể được tạo ra bởi người có thông tin về khoá bí mật, và bất cứ ai cũng có thể tiếp cận được khoá công khai để có thể _xác minh_ chữ ký này. Thuộc tính hữu ích này của mật mã bất đối xứng cho phép bất cứ ai cũng có thể xác minh mọi chữ ký trên mọi giao dịch, trong khi vẫn đảm bảo rằng chỉ những chủ sở hữu khoá bí mật mới có thể tạo ra được chữ ký hợp lệ.

## Khoá bí mật và khoá công khai

### Khoá bí mật

Một khoá bí mật - `private key` chỉ đơn thuần là một con số được chọn ra ngẫu nhiên.

Đúng như cái tên của nó, `private key` cần được giữ bí mật, nên việc chọn ra số ngẫu nhiên phải vô cùng an toàn và đảm bảo tính **thực sự ngẫu nhiên** để tránh các cuộc tấn công vét cạn hay các cuộc tấn công khác nhằm lấy được `private key`.

Vì sao `private key` lại quan trọng ? vì nó tạo ra **chữ ký**, và chứng minh rằng dữ liệu, hay tài sản thuộc về quyền sở hữu của người có private key.

Chính vì vậy việc bảo vệ private key là vô cùng quan trọng. Tuyệt đối không chia sẻ private key cho ai khác, và hãy giữ private key ở một nơi an toàn, vì một khi mất đi sẽ không thể khôi phục lại được, đồng nghĩa với việc ta có thể sẽ mất đi toàn bộ quyền chứng thực với dữ liệu hay tài sản của ta.

### Khoá công khai

Khác với `private key`, `public key` được công khai cho tất cả mọi người.

`public key` được tạo ra bởi **phép nhân** với `private key` trong **đường cong Elliptic**, ta sẽ nói rõ hơn ở phần tiếp theo.

Phép nhân đường cong Elliptic là một phép toán **trap door** (cửa lật), có nghĩa là nó dễ tính theo một chiều (phép nhân) và không thể tính được theo chiều ngược lại (phép chia).

Do đó người sở hữu private key có thể dễ dàng tạo ra khoá công khai và yên tâm chia sẻ với mọi người mà không lo lắng rằng ai đó có thể đảo ngược `public key` để chiếm lấy `private key` của mình.

Lý thuyết này tạo nên nên tảng cho các chữ ký số an toàn và không thể làm giả, ví dụ được dùng đẻ chứng minh quyền sở hữu đối với Bitcoin hay Ethereum trên các mạng blockchain.

## Đường cong Elliptic

## Công thức

Công thức của đường cong Elliptic là:

$$ y^2 \pmod p = x^3 + ax + b \pmod p $$

Kiến thức về đường cong elliptic nói chung khá là rộng, nên trong khuôn khổ bài này chúng ta sẽ chỉ đi vào một đường cong cụ thể được sử dụng trong blockchain mà thôi.

Bitcoin hay Ethereum sử dụng một đường cong theo tiêu chuẩn `secp256k1` do _Viện Tiêu Chuẩn và Kỹ Thuật Quốc Gia Mỹ_ (NIST) đặt ra.

Đường cong này có công thức như sau:

$$ y^2 \pmod p = x^3 + 7 \pmod p $$

với `p` là một số nguyên tố rất lớn, $$ p = 2^{265} - 2^{32} - 2^9 - 2^8 - 2^7 - 2^6 - 2^4 - 1 $$.

Hình dưới minh hoạ một đường cong elliptic được sử dụng trong Bitcoin & Ethereum.

![elliptic]({{ site.url }}/assets/images/ecdsa/elliptic.png)

## Các phép toán trên đường cong Elliptic

Có 2 phép toán quan trọng trên đường cong Elliptic: **phép cộng** và **phép nhân**

### Phép cộng

Đường cong Elliptic có một tính chất: "Nếu hai điểm P và Q nằm trên đường cong, thì điểm P+Q cũng sẽ nằm trên đường cong".

Điểm này được xác định như sau:

- Vẽ đường thẳng nối 2 điểm P và Q, đường thẳng này sẽ cắt đường cong tại một điểm nữa
- Lấy đối xứng của điểm này qua trục hoành, ta sẽ có được P+Q

Hình dưới mô tả phép cộng được tiến hành trong đường cong Elliptic thế nào:

![add]({{ site.url }}/assets/images/ecdsa/add.png)

> Nếu 3 điểm trên đường cong Elliptic là thẳng hàng, thì tổng của chúng bằng 0.

## Phép nhân

Trên đường cong Elliptic, việc nhân một điểm với một hằng số không đơn thuần chỉ là lấy từng toạ độ rồi rồi nhân là xong.

Thực chất, phép nhân ở đây vẫn là _phép cộng_, nhưng thực hiện nhiều lần mà thôi.

Ví dụ trong phép toán tính `3*P`, đầu tiên ta sẽ tính `2P` bằng cách tính `P+P`.

Theo cách cộng ở bên trên, ta vẽ đường thẳng nối P và P, ở đây chính là _tiếp tuyến_ của đường cong, nó cắt đường cong tại điểm `-2P`, lấy đối xứng qua trục hoành ta có `2P`.

Tiếp tục vẽ đường thẳng nối giữa `2P` và `P`, cắt đường cong tại `-3P`, lấy đối xứng ta có `3P`.

Hình dưới mô tả phép nhân được tiến hành trong đường cong Elliptic thế nào:

![mul]({{ site.url }}/assets/images/ecdsa/mul.png)

Do cách tính toán trên, ta có thể dễ dàng tính toán được phép nhân `k*P` khi biết `k` và `P`, nhưng hoàn toàn không thể tính toán được theo chiều ngược lại, tức phép chia. Đó cũng chính là tính chất đặc trưng của mã hoá bất đối xứng. Sau đây ta sẽ dùng nó để tạo ra `public key`.

## Tạo public key

Ok ta đã nắm được lý thuyết về các phép toán trên đường cong Elliptic, giờ ta sẽ tìm hiểu xem "public key được tạo ra như thế nào".
